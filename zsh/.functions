# Move files to trash instead of deleting
trash() {
  mkdir -p ~/.trash
  mv "$@" ~/.trash/
}

# Restore a file from trash
restore() {
  file="$1"
  if [ -f "$HOME/.trash/$file" ]; then
    mv "$HOME/.trash/$file" .
    echo "‚úÖ Restored $file"
  else
    echo "‚ùå File not found."
  fi
}


edif() {
#  nano "$(find ~/dotfiles-enhanced/dotfiles-enhanced -type f | fzf)"
   nvim "$(find ~/ -type f | fzf)" 
}


#openapp() {
#  local app
#  app=$(ls /usr/share/applications ~/.local/share/applications 2>/dev/null | sed 's/\.desktop$//' | fzf)
#  [ -n "$app" ] && gtk-launch "$app"
#}
#openapp() {
#  local app
#  app=$(ls /usr/share/applications ~/.local/share/applications 2>/dev/null | sed 's/\.desktop$//' | fzf)
#  [ -n "$app" ] && gtk-launch "$app" >/dev/null 2>&1 &
#}
openapp() {
  local os
  os=$(uname -s)

  if [[ "$os" == "Darwin" ]]; then
    # macOS GUI picker
    osascript >/dev/null 2>&1 <<'EOF' &
      set appList to paragraphs of (do shell script "ls /Applications | grep \\.app | sed 's/\\.app$//'")
      if (count of appList) = 0 then return
      set selectedApp to choose from list appList with prompt "Launch an app:" default items {"Safari"} without multiple selections allowed and empty selection allowed
      if selectedApp is not false then
        do shell script "open -a " & quoted form of selectedApp
      end if
EOF

  elif [[ "$os" == "Linux" ]]; then
    # Linux + Wayland: Wofi launcher with ALL desktop entries
    {
      find /usr/share/applications \
           ~/.local/share/applications \
           ~/.local/share/flatpak/exports/share/applications \
           /var/lib/flatpak/exports/share/applications \
           /var/lib/snapd/desktop/applications \
           -type f -name '*.desktop' 2>/dev/null \
      | sed 's:.*/::' \
      | sed 's/\.desktop$//' \
      | sort -u
    } | wofi --show dmenu --prompt "Launch App:" --allow-markup \
      | while read -r app; do
        gtk-launch "$app" >/dev/null 2>&1 &
      done

  else
    echo "‚ùå Unsupported OS: $os"
  fi
}



openapp_widget() {
  zle -I                # Disable current input
  openapp               # Call your fuzzy launcher
  zle reset-prompt      # Refresh prompt after
}
zle -N openapp_widget    # Register as a widget

editfile_widget() {
  zle -I                # Disable current input
  edif               # Call your fuzzy launcher
  zle reset-prompt      # Refresh prompt after
}
zle -N editfile_widget    # Register as a widget


#Git add . + git commit -m " "
gac() {
  git add .
  echo -n "üìù Commit message: "
  read msg
  git commit -m "$msg"
}

gacp() {
  git add .
  echo -n "üìù Commit message: "
  read msg
  git commit -m "$msg"
  git push
}

gmergef() {
  local branch
  branch=$(git branch --all | grep -v HEAD | sed 's/remotes\///' | sed 's/\* //' | fzf)
  [ -n "$branch" ] && git merge "${branch##*/}"
}

# Interactive branch switcher with fzf
gco() {
  local branch
  branch=$(git branch --all | grep -v HEAD | sed 's/remotes\///' | sed 's/\* //' | fzf --preview 'git log --oneline --graph --color=always {}')
  if [ -n "$branch" ]; then
    git checkout "${branch##*/}"
  fi
}

# Interactive git log viewer with fzf
glogf() {
  git log --oneline --graph --color=always --all | \
    fzf --ansi --no-sort --reverse --tiebreak=index \
        --preview 'echo {} | grep -o "[a-f0-9]\{7,\}" | head -1 | xargs git show --color=always' \
        --bind 'enter:execute(echo {} | grep -o "[a-f0-9]\{7,\}" | head -1 | xargs git show | less -R)'
}

# Interactive stash viewer and applier
gstash() {
  local stash
  stash=$(git stash list | fzf --preview 'echo {} | cut -d: -f1 | xargs git stash show -p --color=always')
  if [ -n "$stash" ]; then
    local stash_id=$(echo "$stash" | cut -d: -f1)
    echo "Apply stash $stash_id? (y/n)"
    read -r response
    if [[ "$response" =~ ^[Yy]$ ]]; then
      git stash pop "$stash_id"
    fi
  fi
}

# Quick commit with auto-generated message based on changes
gquick() {
  local files_changed=$(git diff --cached --name-only | wc -l)
  if [ "$files_changed" -eq 0 ]; then
    echo "‚ö†Ô∏è  No staged changes. Staging all changes..."
    git add .
  fi
  
  local msg="Quick update: $(git diff --cached --name-only | head -3 | tr '\n' ', ' | sed 's/,$//')"
  git commit -m "$msg"
  echo "‚úÖ Committed: $msg"
}

# Create a new branch and switch to it
gnew() {
  if [ -z "$1" ]; then
    echo "Usage: gnew <branch-name>"
    return 1
  fi
  git checkout -b "$1"
}

# Delete branches interactively with fzf
gdel() {
  local branches
  branches=$(git branch | grep -v "^\*" | fzf --multi --preview 'git log --oneline --graph --color=always {}')
  if [ -n "$branches" ]; then
    echo "$branches" | xargs git branch -d
  fi
}


